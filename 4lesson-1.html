<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>бродилка</title>
</head>

<body>
    <script>
        "use strict";

        const settings = {
            rowsCount: 10,
            colsCount: 10,
            startPositionX: 1,
            startPositionY: 1,
        }

        const player = {
            x: null,
            y: null,

            init(startX, startY) {
                this.x = startX;
                this.y = startY;
            },

            move(nextPoint) {
                this.x = nextPoint.x;
                this.y = nextPoint.y;
            },

            /** отдает следуюшую точку, в которой будет находиться
             * принимает направление
             * возвращает слудющую точку игрока
             */
            getNextPosition(direction) {
                const nextPosition = {
                    x: this.x,
                    y: this.y,
                };

                switch (direction) {
                    case 1:
                        nextPosition.y++;
                        nextPosition.x--;
                        break;
                    case 2:
                        nextPosition.y++;
                        break;
                    case 3:
                        nextPosition.y++;
                        nextPosition.x++;
                        break;
                    case 4:
                        nextPosition.x--;
                        break;
                    case 6:
                        nextPosition.x++;
                        break;
                    case 7:
                        nextPosition.y--;
                        nextPosition.x--;
                        break;
                    case 8:
                        nextPosition.y--;
                        break;
                    case 9:
                        nextPosition.y--;
                        nextPosition.x++;
                        break;
                }
                return nextPosition;
            },
        }

        const game = {
            settings,
            player,

            run() {
                this.player.init(this.settings.startPositionX, this.settings.startPositionY);

                while (true) {
                    this.render();

                    const direction = this.getDirection();

                    if (direction === -1) {
                        alert('до свидания!');
                        return;
                    }

                    const nextPoint = this.player.getNextPosition(direction);

                    if (this.canPlayerMakeStep(nextPoint)) {
                        //Двигаем игрока
                        this.player.move(nextPoint);
                    }
                }
            },

            render() {
                let map = "";

                for (let row = 0; row < this.settings.rowsCount; row++) {
                    for (let col = 0; col < this.settings.colsCount; col++) {
                        if (col === this.player.x && row === this.player.y) {
                            map += 'o ';
                            continue;
                        }
                        map += 'x ';
                    }
                    map += '\n';
                }

                console.clear();
                console.log(map);
            },

            getDirection() {
                const avalabelDirections = [-1, 2, 1, 4, 7, 8, 9, 6, 3];

                while (true) {
                    const direction = parseInt(prompt(
                        'введите число, куда Вы хотите переместиться, -1 для выхода'));
                    if (!avalabelDirections.includes(direction)) {
                        alert(`введите одно из следующих чисел ${avalabelDirections.join(', ')}`);
                        continue;
                    }
                    return direction;
                }
            },

            /**
             * проверяет может ли пользователь сделать шаг на точку
             * @param {{x: int, y: int}}принимаем некст поинт, точку
             * @returns {boolean} true если пользователь может пройти   false возвращаем правду или ложь
             * */
            canPlayerMakeStep(nextPoint) {
                if (nextPoint.x < this.settings.colsCount && nextPoint.x >= 0 && nextPoint.y < this.settings
                    .rowsCount && nextPoint.y >= 0) {
                    return true;
                } else {
                    return false;
                }
            }
        };

        game.run();
    </script>
</body>

</html>